"use strict";(()=>{var e={};e.id=345,e.ids=[345],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(e,n)=>{Object.defineProperty(n,"l",{enumerable:!0,get:function(){return function e(n,r){return r in n?n[r]:"then"in n&&"function"==typeof n.then?n.then(n=>e(n,r)):"function"==typeof n&&"default"===r?n:void 0}}})},229:(e,n,r)=>{r.r(n),r.d(n,{config:()=>d,default:()=>c,routeModule:()=>u});var i={};r.r(i),r.d(i,{default:()=>s});var o=r(1802),t=r(7153),a=r(6249),l=r(3951);async function s(e,n){if("POST"!==e.method)return n.status(405).json({error:"Method not allowed"});try{let{amount:r,recipientUserId:i,recipientName:o,note:t}=e.body;if(!r||r<=0)return n.status(400).json({error:"Invalid amount"});if(!i&&!o)return n.status(400).json({error:"Recipient is required"});let a=null;if(i&&l.i)try{let e=l.i.collection("users").doc(i),n=await e.get();if(n.exists){let e=n.data();a=e?.venmoUsername||null}}catch(e){console.error("Error fetching recipient Venmo username:",e)}if(!a&&o&&l.i)try{let e=await l.i.collection("users").where("name","==",o).limit(1).get();if(!e.empty){let n=e.docs[0].data();a=n?.venmoUsername||null}}catch(e){console.error("Error finding user by name:",e)}let s=null,c=null;a&&(s=`venmo://paycharge?txn=pay&recipients=${encodeURIComponent(a)}&amount=${r}&note=${encodeURIComponent(t||"SquareUp payment")}`,c=`https://venmo.com/${encodeURIComponent(a)}?txn=pay&amount=${r}&note=${encodeURIComponent(t||"SquareUp payment")}`),n.status(200).json({venmoLink:s,venmoWebLink:c,venmoUsername:a,hasVenmoUsername:!!a,amount:r,note:t||"SquareUp payment"})}catch(e){console.error("Venmo link generation error:",e),n.status(500).json({error:e.message||"Failed to generate Venmo link"})}}let c=(0,a.l)(i,"default"),d=(0,a.l)(i,"config"),u=new o.PagesAPIRouteModule({definition:{kind:t.x.PAGES_API,page:"/api/venmo/generate-payment-link",pathname:"/api/venmo/generate-payment-link",bundlePath:"",filename:""},userland:i})},3951:(e,n,r)=>{r.d(n,{C:()=>u,i:()=>d});let i=require("firebase-admin"),o=require("path");var t=r.n(o);let a=require("fs");var l=r.n(a);let s="firebase-service-account.json";if(!global._firebaseAdminApp){if(s)try{let e=t().join(process.cwd(),s);if(l().existsSync(e)){let n=l().readFileSync(e,"utf8"),r=JSON.parse(n),o=["project_id","private_key","client_email"].filter(e=>!r[e]);o.length>0?console.error(`Service account JSON missing required fields: ${o.join(", ")}`):(global._firebaseAdminApp=i.initializeApp({credential:i.credential.cert(r)}),console.log("Firebase Admin SDK initialized successfully (via globalThis). Once."),console.log("Initialized Firebase App instance:",global._firebaseAdminApp.name),console.log("Project ID:",r.project_id))}else console.error(`Firebase service account file not found at: ${e}`),console.error("Please ensure the file exists and the path is correct.")}catch(e){throw console.error("Firebase admin initialization error:",e),console.error("Please check:"),console.error("1. The service account JSON file is valid"),console.error("2. The service account has proper permissions"),console.error("3. The FIREBASE_ADMIN_SDK_PATH is correct"),Error("Failed to initialize Firebase Admin SDK. Check FIREBASE_ADMIN_SDK_PATH and file content.")}else console.error("Firebase Admin SDK path is missing. Admin SDK will not be initialized."),console.error("Please set FIREBASE_ADMIN_SDK_PATH in your .env.local file")}let c=global._firebaseAdminApp;c||console.error("Admin SDK failed to initialize. Exported functions will not work.");let d=c?c.firestore():null,u=c?c.auth():null;d&&console.log("adminDb initialized. Project ID:",c?.options.projectId),u&&console.log("adminAuth initialized.")},7153:(e,n)=>{var r;Object.defineProperty(n,"x",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},1802:(e,n,r)=>{e.exports=r(145)}};var n=require("../../../webpack-api-runtime.js");n.C(e);var r=n(n.s=229);module.exports=r})();