(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[233],{5278:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/join",function(){return r(4985)}])},6866:function(e,t,r){"use strict";r.d(t,{Ab:function(){return i.Ab},Ap:function(){return c},Bt:function(){return i.Bt},ET:function(){return i.ET},I8:function(){return l},IO:function(){return i.IO},JU:function(){return i.JU},QT:function(){return i.QT},ar:function(){return i.ar},cf:function(){return i.cf},db:function(){return a},oe:function(){return i.oe},r7:function(){return i.r7},vr:function(){return i.vr},z1:function(){return u}});var n=r(3106),o=r(5876),i=r(9828);let s=(0,n.C6)().length?(0,n.Mq)():(0,n.ZF)({apiKey:"AIzaSyChtios867UY-BnI2y0msZtOJV25pedC9E",authDomain:"squareup-32d41.firebaseapp.com",projectId:"squareup-32d41",storageBucket:"squareup-32d41.firebasestorage.app",messagingSenderId:"583310661278",appId:"1:583310661278:web:d0621e1e11393758978d8f",measurementId:"G-N0C6MEMN7G"}),l=(0,o.v0)(s),c=new o.hJ;c.setCustomParameters({prompt:"select_account"});let a=(0,i.ad)(s),u=(0,i.hJ)(a,"servers")},4985:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return y}});var n=r(5893),o=r(7294),i=r(1163),s=r(6459),l=r(1046),c=r(8186),a=r(8899),u=r(92),d=r(8029),m=r(232),f=r(8491),g=r(3636),h=r(5876),p=r(9828),v=r(6866);function y(){let e=(0,i.useRouter)(),t=(0,s.p)(),{email:r,serverId:y,server:b}=e.query,[x,j]=(0,o.useState)(!0),[w,I]=(0,o.useState)(null),[E,S]=(0,o.useState)(null);(0,l.ff)("gray.50","gray.900"),(0,l.ff)("white","gray.800"),(0,l.ff)("gray.200","gray.600"),(0,l.ff)("gray.900","gray.100");let A=(0,l.ff)("gray.600","gray.400");(0,o.useEffect)(()=>{console.log("Join page loaded with params:",{email:r,serverId:y,serverName:b}),console.log("Full URL:",window.location.href);let e=(0,h.Aj)(v.I8,e=>{console.log("Auth state changed:",null==e?void 0:e.email),S(e),!e&&r?(I("Please log in with ".concat(r," to join the server.")),j(!1)):e&&r&&(y||b)?(console.log("Authenticated user detected, proceeding to join server:",{currentUserEmail:e.email,invitedEmail:r}),z(e)):r&&(y||b)||(I("Invalid invitation link. Missing email or server information."),j(!1))});return()=>e()},[r,y,e,E]);let C=async()=>{try{await (0,h.rh)(v.I8,v.Ap)}catch(e){console.error("Login error:",e),I("Failed to log in. Please try again.")}},z=async r=>{j(!0),I(null);try{console.log("Attempting to join server with user:",null==r?void 0:r.email);let n=null,o="";if(y){console.log("Getting server by ID:",y);let e=(0,p.JU)(v.db,"servers",y),t=await (0,p.QT)(e);if(console.log("Server doc result:",{exists:t.exists(),id:t.id}),!t.exists())throw Error("Server not found. The invitation may be invalid.");n=t.data(),o=t.id,console.log("Server data retrieved:",{name:null==n?void 0:n.name,memberIds:null==n?void 0:n.memberIds})}else if(b){console.log("Getting server by name:",b);let e=(0,p.hJ)(v.db,"servers"),t=(0,p.IO)(e,(0,p.ar)("name","==",b)),r=await (0,p.PL)(t);if(console.log("Query result:",{empty:r.empty,size:r.size}),r.empty)throw Error('Server "'.concat(b,'" not found. The invitation may be invalid.'));let i=r.docs[0];n=i.data(),o=i.id}else throw Error("Server ID or name is required");if(n.memberIds&&n.memberIds.includes(r.uid)){t({title:"Already a member",description:"You're already a member of \"".concat(n.name,'"'),status:"info",duration:3e3,isClosable:!0}),e.push("/");return}let i=r.displayName||r.email||"Anonymous",s=(0,p.JU)(v.db,"servers",o);await (0,p.r7)(s,{members:(0,p.vr)(i),memberIds:(0,p.vr)(r.uid)}),console.log("Successfully added user to server:",{userDisplayName:i,userId:r.uid,serverId:o,serverName:n.name}),t({title:'\uD83C\uDF89 Successfully joined "'.concat(n.name,'"!'),description:"You can now track expenses and collaborate with other members in real-time.",status:"success",duration:6e3,isClosable:!0}),setTimeout(()=>{e.push("/")},1e3)}catch(e){console.error("Error joining server:",e),console.error("Error code:",e.code),console.error("Error message:",e.message),"permission-denied"===e.code?I("Permission denied. Please make sure you are logged in with the correct account."):I(e.message||"Failed to join server")}finally{j(!1)}};return x?(0,n.jsxs)(c.g,{justify:"center",align:"center",minH:"100vh",children:[(0,n.jsx)(a.$,{size:"xl"}),(0,n.jsx)(u.x,{children:"Joining server..."})]}):w?(0,n.jsxs)(c.g,{justify:"center",align:"center",minH:"100vh",p:4,spacing:6,children:[(0,n.jsxs)(d.x,{textAlign:"center",children:[(0,n.jsx)(m.X,{size:"lg",color:"red.500",mb:2,children:"Invitation"}),(0,n.jsx)(u.x,{textAlign:"center",mb:4,children:w})]}),!E&&(0,n.jsx)(f.z,{leftIcon:(0,n.jsx)(u.x,{children:"\uD83D\uDD10"}),onClick:C,bg:"#4285F4",color:"white",size:"lg",px:8,_hover:{bg:"#3367D6"},children:"Sign in with Google"}),E&&(w.includes("invited email")||w.includes("currently logged in")||w.includes("Email mismatch"))&&(0,n.jsxs)(c.g,{spacing:3,children:[(0,n.jsxs)(u.x,{fontSize:"sm",color:A,children:["You're currently signed in as: ",E.email]}),(0,n.jsxs)(g.U,{spacing:3,children:[(0,n.jsx)(f.z,{onClick:()=>{console.log("User chose to continue with current account"),I(null),z(E)},colorScheme:"green",size:"sm",children:"Continue with this account"}),(0,n.jsx)(f.z,{onClick:()=>v.I8.signOut().then(()=>e.reload()),variant:"outline",colorScheme:"red",size:"sm",children:"Sign out and use different account"})]})]}),(0,n.jsx)(f.z,{onClick:()=>e.push("/"),variant:"ghost",children:"Go to Home"})]}):(0,n.jsxs)(c.g,{justify:"center",align:"center",minH:"100vh",children:[(0,n.jsx)(m.X,{size:"xl",children:"Redirecting..."}),(0,n.jsx)(u.x,{children:"You should be redirected shortly."})]})}},1163:function(e,t,r){e.exports=r(3079)},3636:function(e,t,r){"use strict";r.d(t,{U:function(){return i}});var n=r(5893),o=r(4204);let i=(0,r(9381).G)((e,t)=>(0,n.jsx)(o.K,{align:"center",...e,direction:"row",ref:t}));i.displayName="HStack"},6459:function(e,t,r){"use strict";r.d(t,{p:function(){return a}});var n=r(7294),o=r(2847),i=r(4075),s=r(1065),l=r(8559),c=r(4107);function a(e){let{theme:t}=(0,c.uP)(),r=(0,l.OX)();return(0,n.useMemo)(()=>(function(e,t){let r=r=>({...t,...r,position:function(e,t){let r=e??"bottom";return({"top-start":{ltr:"top-left",rtl:"top-right"},"top-end":{ltr:"top-right",rtl:"top-left"},"bottom-start":{ltr:"bottom-left",rtl:"bottom-right"},"bottom-end":{ltr:"bottom-right",rtl:"bottom-left"}})[r]?.[t]??r}(r?.position??t?.position,e)}),n=e=>{let t=r(e),n=(0,i.C)(t);return s.f.notify(n,t)};return n.update=(e,t)=>{s.f.update(e,r(t))},n.promise=(e,t)=>{let r=n({...t.loading,status:"loading",duration:null});e.then(e=>n.update(r,{status:"success",duration:5e3,...(0,o.P)(t.success,e)})).catch(e=>n.update(r,{status:"error",duration:5e3,...(0,o.P)(t.error,e)}))},n.closeAll=s.f.closeAll,n.close=s.f.close,n.isActive=s.f.isActive,n})(t.direction,{...r,...e}),[e,t.direction,r])}}},function(e){e.O(0,[703,893,2,888,774,179],function(){return e(e.s=5278)}),_N_E=e.O()}]);