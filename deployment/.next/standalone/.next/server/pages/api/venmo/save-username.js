"use strict";(()=>{var e={};e.id=197,e.ids=[197],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(e,r)=>{Object.defineProperty(r,"l",{enumerable:!0,get:function(){return function e(r,i){return i in r?r[i]:"then"in r&&"function"==typeof r.then?r.then(r=>e(r,i)):"function"==typeof r&&"default"===i?r:void 0}}})},449:(e,r,i)=>{i.r(r),i.d(r,{config:()=>u,default:()=>c,routeModule:()=>d});var n={};i.r(n),i.d(n,{default:()=>l});var o=i(1802),t=i(7153),s=i(6249),a=i(3951);async function l(e,r){if("POST"!==e.method)return r.status(405).json({error:"Method not allowed"});try{let{userId:i,username:n}=e.body;if(!i)return r.status(400).json({error:"User ID is required"});if(!n||!n.trim())return r.status(400).json({error:"Username is required"});let o=n.trim().replace(/^@/,"").toLowerCase();if(!/^[a-z0-9_-]+$/.test(o))return r.status(400).json({error:"Invalid username format. Use only letters, numbers, hyphens, and underscores."});if(!a.i)return r.status(500).json({error:"Firebase Admin SDK not initialized"});let t=a.i.collection("users").doc(i);await t.set({venmoUsername:o,updatedAt:Date.now()},{merge:!0}),r.status(200).json({success:!0,username:o})}catch(e){console.error("Error saving Venmo username:",e),r.status(500).json({error:e.message||"Failed to save username"})}}let c=(0,s.l)(n,"default"),u=(0,s.l)(n,"config"),d=new o.PagesAPIRouteModule({definition:{kind:t.x.PAGES_API,page:"/api/venmo/save-username",pathname:"/api/venmo/save-username",bundlePath:"",filename:""},userland:n})},3951:(e,r,i)=>{i.d(r,{C:()=>d,i:()=>u});let n=require("firebase-admin"),o=require("path");var t=i.n(o);let s=require("fs");var a=i.n(s);let l="firebase-service-account.json";if(!global._firebaseAdminApp){if(l)try{let e=t().join(process.cwd(),l);if(a().existsSync(e)){let r=a().readFileSync(e,"utf8"),i=JSON.parse(r),o=["project_id","private_key","client_email"].filter(e=>!i[e]);o.length>0?console.error(`Service account JSON missing required fields: ${o.join(", ")}`):(global._firebaseAdminApp=n.initializeApp({credential:n.credential.cert(i)}),console.log("Firebase Admin SDK initialized successfully (via globalThis). Once."),console.log("Initialized Firebase App instance:",global._firebaseAdminApp.name),console.log("Project ID:",i.project_id))}else console.error(`Firebase service account file not found at: ${e}`),console.error("Please ensure the file exists and the path is correct.")}catch(e){throw console.error("Firebase admin initialization error:",e),console.error("Please check:"),console.error("1. The service account JSON file is valid"),console.error("2. The service account has proper permissions"),console.error("3. The FIREBASE_ADMIN_SDK_PATH is correct"),Error("Failed to initialize Firebase Admin SDK. Check FIREBASE_ADMIN_SDK_PATH and file content.")}else console.error("Firebase Admin SDK path is missing. Admin SDK will not be initialized."),console.error("Please set FIREBASE_ADMIN_SDK_PATH in your .env.local file")}let c=global._firebaseAdminApp;c||console.error("Admin SDK failed to initialize. Exported functions will not work.");let u=c?c.firestore():null,d=c?c.auth():null;u&&console.log("adminDb initialized. Project ID:",c?.options.projectId),d&&console.log("adminAuth initialized.")},7153:(e,r)=>{var i;Object.defineProperty(r,"x",{enumerable:!0,get:function(){return i}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(i||(i={}))},1802:(e,r,i)=>{e.exports=i(145)}};var r=require("../../../webpack-api-runtime.js");r.C(e);var i=r(r.s=449);module.exports=i})();