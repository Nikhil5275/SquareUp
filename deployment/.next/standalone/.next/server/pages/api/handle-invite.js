"use strict";(()=>{var e={};e.id=11,e.ids=[11],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(e,i)=>{Object.defineProperty(i,"l",{enumerable:!0,get:function(){return function e(i,t){return t in i?i[t]:"then"in i&&"function"==typeof i.then?i.then(i=>e(i,t)):"function"==typeof i&&"default"===t?i:void 0}}})},5962:(e,i,t)=>{t.r(i),t.d(i,{config:()=>c,default:()=>d,routeModule:()=>u});var r={};t.r(r),t.d(r,{default:()=>l});var n=t(1802),s=t(7153),o=t(6249),a=t(3951);async function l(e,i){if("POST"===e.method){let{token:t,userEmail:r,userId:n}=e.body;if(!t||!r||!n)return i.status(400).json({message:"Missing required fields"});try{if(!a.i)return i.status(500).json({message:"Firebase Admin SDK not initialized. Please check service account configuration.",error:"Firebase Admin SDK not initialized"});let e=a.i.collection("invitations").doc(t),n=await e.get();if(!n.exists)return i.status(404).json({message:"Invitation not found or invalid."});let s=n.data();if(!s)return i.status(404).json({message:"Invitation data not found."});if(s.used)return i.status(400).json({message:"This invitation has already been used."});if(s.expiresAt<Date.now())return i.status(400).json({message:"This invitation has expired."});if(s.invitedEmail!==r)return i.status(403).json({message:"You must log in with the invited email address to accept this invitation."});let o=a.i.collection("servers").doc(s.serverId),l=await o.get();if(!l.exists)return i.status(404).json({message:"Server not found."});let d=l.data();if(!d)return i.status(404).json({message:"Server data not found."});if(d.members?.includes(r))return await e.update({used:!0}),i.status(200).json({message:"You are already a member of this server.",serverName:d.name});await o.update({members:[...d.members||[],r]}),await e.update({used:!0}),i.status(200).json({message:"Successfully joined server",serverName:d.name})}catch(e){console.error("Error handling invite:",e),i.status(500).json({message:"Failed to process invitation",error:e.message})}}else i.setHeader("Allow",["POST"]),i.status(405).end(`Method ${e.method} Not Allowed`)}let d=(0,o.l)(r,"default"),c=(0,o.l)(r,"config"),u=new n.PagesAPIRouteModule({definition:{kind:s.x.PAGES_API,page:"/api/handle-invite",pathname:"/api/handle-invite",bundlePath:"",filename:""},userland:r})},3951:(e,i,t)=>{t.d(i,{C:()=>u,i:()=>c});let r=require("firebase-admin"),n=require("path");var s=t.n(n);let o=require("fs");var a=t.n(o);let l="firebase-service-account.json";if(!global._firebaseAdminApp){if(l)try{let e=s().join(process.cwd(),l);if(a().existsSync(e)){let i=a().readFileSync(e,"utf8"),t=JSON.parse(i),n=["project_id","private_key","client_email"].filter(e=>!t[e]);n.length>0?console.error(`Service account JSON missing required fields: ${n.join(", ")}`):(global._firebaseAdminApp=r.initializeApp({credential:r.credential.cert(t)}),console.log("Firebase Admin SDK initialized successfully (via globalThis). Once."),console.log("Initialized Firebase App instance:",global._firebaseAdminApp.name),console.log("Project ID:",t.project_id))}else console.error(`Firebase service account file not found at: ${e}`),console.error("Please ensure the file exists and the path is correct.")}catch(e){throw console.error("Firebase admin initialization error:",e),console.error("Please check:"),console.error("1. The service account JSON file is valid"),console.error("2. The service account has proper permissions"),console.error("3. The FIREBASE_ADMIN_SDK_PATH is correct"),Error("Failed to initialize Firebase Admin SDK. Check FIREBASE_ADMIN_SDK_PATH and file content.")}else console.error("Firebase Admin SDK path is missing. Admin SDK will not be initialized."),console.error("Please set FIREBASE_ADMIN_SDK_PATH in your .env.local file")}let d=global._firebaseAdminApp;d||console.error("Admin SDK failed to initialize. Exported functions will not work.");let c=d?d.firestore():null,u=d?d.auth():null;c&&console.log("adminDb initialized. Project ID:",d?.options.projectId),u&&console.log("adminAuth initialized.")},7153:(e,i)=>{var t;Object.defineProperty(i,"x",{enumerable:!0,get:function(){return t}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(t||(t={}))},1802:(e,i,t)=>{e.exports=t(145)}};var i=require("../../webpack-api-runtime.js");i.C(e);var t=i(i.s=5962);module.exports=t})();