"use strict";(()=>{var e={};e.id=611,e.ids=[611],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6090:e=>{e.exports=import("stripe")},6249:(e,r)=>{Object.defineProperty(r,"l",{enumerable:!0,get:function(){return function e(r,i){return i in r?r[i]:"then"in r&&"function"==typeof r.then?r.then(r=>e(r,i)):"function"==typeof r&&"default"===i?r:void 0}}})},3037:(e,r,i)=>{i.a(e,async(e,t)=>{try{i.r(r),i.d(r,{config:()=>u,default:()=>c,routeModule:()=>d});var o=i(1802),n=i(7153),s=i(6249),a=i(8448),l=e([a]);a=(l.then?(await l)():l)[0];let c=(0,s.l)(a,"default"),u=(0,s.l)(a,"config"),d=new o.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/stripe/get-account-link",pathname:"/api/stripe/get-account-link",bundlePath:"",filename:""},userland:a});t()}catch(e){t(e)}})},3951:(e,r,i)=>{i.d(r,{C:()=>d,i:()=>u});let t=require("firebase-admin"),o=require("path");var n=i.n(o);let s=require("fs");var a=i.n(s);let l="firebase-service-account.json";if(!global._firebaseAdminApp){if(l)try{let e=n().join(process.cwd(),l);if(a().existsSync(e)){let r=a().readFileSync(e,"utf8"),i=JSON.parse(r),o=["project_id","private_key","client_email"].filter(e=>!i[e]);o.length>0?console.error(`Service account JSON missing required fields: ${o.join(", ")}`):(global._firebaseAdminApp=t.initializeApp({credential:t.credential.cert(i)}),console.log("Firebase Admin SDK initialized successfully (via globalThis). Once."),console.log("Initialized Firebase App instance:",global._firebaseAdminApp.name),console.log("Project ID:",i.project_id))}else console.error(`Firebase service account file not found at: ${e}`),console.error("Please ensure the file exists and the path is correct.")}catch(e){throw console.error("Firebase admin initialization error:",e),console.error("Please check:"),console.error("1. The service account JSON file is valid"),console.error("2. The service account has proper permissions"),console.error("3. The FIREBASE_ADMIN_SDK_PATH is correct"),Error("Failed to initialize Firebase Admin SDK. Check FIREBASE_ADMIN_SDK_PATH and file content.")}else console.error("Firebase Admin SDK path is missing. Admin SDK will not be initialized."),console.error("Please set FIREBASE_ADMIN_SDK_PATH in your .env.local file")}let c=global._firebaseAdminApp;c||console.error("Admin SDK failed to initialize. Exported functions will not work.");let u=c?c.firestore():null,d=c?c.auth():null;u&&console.log("adminDb initialized. Project ID:",c?.options.projectId),d&&console.log("adminAuth initialized.")},8448:(e,r,i)=>{i.a(e,async(e,t)=>{try{i.r(r),i.d(r,{default:()=>a});var o=i(6090),n=i(3951),s=e([o]);let l=new(o=(s.then?(await s)():s)[0]).default(process.env.STRIPE_SECRET_KEY||"",{apiVersion:"2025-10-29.clover"});async function a(e,r){if("POST"!==e.method)return r.status(405).json({error:"Method not allowed"});try{let{userId:i,accountId:t}=e.body;if(!i||!t)return r.status(400).json({error:"Missing userId or accountId"});if(!n.i)return r.status(500).json({error:"Firebase Admin SDK not initialized"});let o=n.i.collection("users").doc(i),s=await o.get();if(!s.exists)return r.status(404).json({error:"User not found"});let a=s.data();if(a?.stripeAccountId!==t)return r.status(403).json({error:"Account does not belong to user"});let c=await l.accountLinks.create({account:t,refresh_url:`${e.headers.origin||"http://localhost:3000"}/settings?stripe=refresh`,return_url:`${e.headers.origin||"http://localhost:3000"}/settings?stripe=success`,type:"account_onboarding"});r.status(200).json({url:c.url})}catch(e){console.error("Stripe account link error:",e),r.status(500).json({error:e.message||"Failed to create account link"})}}t()}catch(e){t(e)}})},7153:(e,r)=>{var i;Object.defineProperty(r,"x",{enumerable:!0,get:function(){return i}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(i||(i={}))},1802:(e,r,i)=>{e.exports=i(145)}};var r=require("../../../webpack-api-runtime.js");r.C(e);var i=r(r.s=3037);module.exports=i})();